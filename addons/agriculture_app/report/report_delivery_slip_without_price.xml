<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Add Paperformat -->
    <record id="paperformat_custom_delivery_slip" model="report.paperformat">
        <field name="name">出退貨單紙張格式</field>
        <field name="default" eval="True" />
        <field name="format">custom</field>
        <field name="page_height">240</field>
        <field name="page_width">140</field>
        <field name="margin_top">10</field>
        <field name="margin_bottom">10</field>
        <field name="margin_left">10</field>
        <field name="margin_right">10</field>
        <field name="header_line" eval="False" />
        <field name="header_spacing">0</field>
        <field name="dpi">100</field>
    </record>
    <!-- Add Report Action -->
    <record id="action_report_delivery_slip_without_price" model="ir.actions.report">
        <field name="name">列印貨單（未顯示金額）</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">agriculture_app.report_delivery_slip_without_price</field>
        <field name="report_file">agriculture_app.report_delivery_slip_without_price</field>
        <field name="binding_model_id" ref="model_stock_picking" />
        <field name="paperformat_id" ref="agriculture_app.paperformat_custom_delivery_slip" />
        <field name="binding_type">report</field>
    </record>


    <!-- Add Report template -->
    <template id="report_delivery_slip_without_price">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.basic_layout">
                    <t t-set="o" t-value="o.with_context(lang=o._get_report_lang())" />
                    <t t-set="partner" t-value="o.partner_id or (o.move_lines and o.move_lines[0].partner_id) or False"/>

                    <div class="wrapper" style="height: 100vh; display: flex; flex-direction: column;">
                        <!-- header -->
                        <table id="custom_header" style="width: 100%; font-size: 16px; margin-bottom: 10px;">
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="company_name">
                                            <span t-field="o.company_id.name"/>
                                        </div>
                                    </td>
                                    <td>
                                        <span>＊＊＊未顯示金額＊＊＊</span>
                                    </td>
                                    <td>
                                        <t t-if="'WH/OUT/' in o.name">
                                            <span t-field="o.name"/>
                                            <span>出貨單</span>
                                        </t>
                                        <t t-if="'WH/RET/' in o.name">
                                            <span t-field="o.name"/>
                                            <span>退貨單</span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="company_address">
                                            <span t-field="o.company_id.street"/>
                                            <span t-field="o.company_id.city"/>
                                            <span t-field="o.company_id.state_id"/>
                                            <span t-field="o.company_id.zip"/>
                                            <span t-field="o.company_id.country_id"/>
                                        </div>
                                    </td>
                                    <td>
                                        <span></span>
                                    </td>
                                    <td>
                                        <span></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span>Tel：</span>
                                        <span t-field="o.company_id.phone"/>
                                        <span>Fax：</span>
                                        <span t-field="o.company_id.fax"/>
                                    </td>
                                    <td>
                                        <span>Website：</span>
                                        <span t-field="o.company_id.website"/>
                                    </td>
                                    <td>
                                        <span>E-Mail：</span>
                                        <span t-field="o.company_id.email"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- info -->
                        <main style="flex: 1;">
                            <table id="info" style="width: 100%; font-size: 16px; margin-bottom: 5px;">
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="customer">客戶名稱：
                                                <span t-field="o.move_lines[0].partner_id.name"/>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="email">電子郵件：
                                                <t t-if="o.move_lines[0].partner_id.email">
                                                    <span t-field="o.move_lines[0].partner_id.email"/>
                                                </t>
                                                <t t-if="not o.move_lines[0].partner_id.email">
                                                    <span></span>
                                                </t>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="date_of_order">訂貨日期：
                                                <span t-field="o.move_lines[0].sale_line_id.order_id.date_order"/>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="contact">
                            聯絡人：
                                                <t t-if="o.move_lines[0].partner_id.child_ids and o.move_lines[0].partner_id.child_ids[0].type == 'delivery'">
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].name"/>
                                                </t>
                                                <t t-else="">
                                                    <span t-field="o.move_lines[0].partner_id.name"/>
                                                </t>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="vat">
                            統一編號：
                                                <t t-if="o.move_lines[0].partner_id.company_type == 'person'">
                                                    <span>個人</span>
                                                </t>
                                                <t t-else="">
                                                    <span t-field="o.move_lines[0].partner_id.vat"/>
                                                </t>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="shipment_date">
                            出貨日期：
                                                <span t-field="o.ShipmentDate"/>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="contact_number">
                            聯絡電話：
                                                <t t-if="o.move_lines[0].partner_id.child_ids and o.move_lines[0].partner_id.child_ids[0].type == 'delivery'">
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].phone"/>
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].mobile"/>
                                                </t>
                                                <t t-else="">
                                                    <span t-field="o.move_lines[0].partner_id.phone"/>
                                                    <span t-field="o.move_lines[0].partner_id.mobile"/>
                                                </t>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="fax">
                            傳真電話：
                                                <span>
                                                    <t t-if="o.move_lines[0].partner_id.fax">
                                                        <span t-field="o.move_lines[0].partner_id.fax"/>
                                                    </t>
                                                    <t t-if="not o.move_lines[0].partner_id.fax">
                                                        <span></span>
                                                    </t>
                                                </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="order_number">
                            貨單編號
                                                <span t-field="o.origin"/>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="delivery_address">
                            送貨地址：
                                                <t t-if="o.move_lines[0].partner_id.child_ids and o.move_lines[0].partner_id.child_ids[0].type == 'delivery'">
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].zip"/>
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].country_id"/>
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].state_id"/>
                                                    <span t-if="o.move_lines[0].partner_id.child_ids[0].city_id" t-field="o.move_lines[0].partner_id.child_ids[0].city_id"/>
                                                    <span t-else="" t-field="o.move_lines[0].partner_id.child_ids[0].city"/>
                                                    <span t-field="o.move_lines[0].partner_id.child_ids[0].street"/>
                                                </t>
                                                <t t-else="">
                                                    <span t-field="o.move_lines[0].partner_id.zip"/>
                                                    <span t-field="o.move_lines[0].partner_id.country_id"/>
                                                    <span t-field="o.move_lines[0].partner_id.state_id"/>
                                                    <span t-if="o.move_lines[0].partner_id.city_id" t-field="o.move_lines[0].partner_id.city_id"/>
                                                    <span t-else="" t-field="o.move_lines[0].partner_id.city"/>
                                                    <span t-field="o.move_lines[0].partner_id.street"/>
                                                </t>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="note">
                                                <span>備註：</span>
                                                <span t-field="o.note"/>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="shipping_method">
                            送貨方式：
                                                <span t-field="o.carrier_id.name"/>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- product details -->
                            <table id="product_details" name="list_of_orders" style="width: 100%; font-size: 16px;">
                                <thead style="border-top: 1px solid black; border-bottom: 1px solid black;">
                                    <tr>
                                        <th>商品編號</th>
                                        <th>品名</th>
                                        <th>數量</th>
                                        <th>單位</th>
                                        <th>單價</th>
                                        <th>金額</th>
                                        <th>包裝數量（單位）</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                                    <tr t-foreach="lines" t-as="move">
                                        <td>
                                            <span t-field="move.product_id.barcode"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_id"/>
                                            <p t-if="move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                                                <span t-field="move.description_picking"/>
                                            </p>
                                        </td>
                                        <td>
                                            <span t-field="move.product_uom_qty"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_uom"/>
                                        </td>
                                        <td>
                                            <!-- <span t-field="move.sale_line_id.price_unit"/> -->
                                            <span>*********</span>
                                        </td>
                                        <td>
                                            <!-- <span t-field="move.sale_line_id.price_subtotal"/> -->
                                            <span>*********</span>
                                        </td>
                                        <td>
                                            <span t-field="move.sale_line_id.product_packaging_qty"/>
                                            <span t-field="move.sale_line_id.product_packaging_id"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </main>

                        <!-- footer -->
                        <div class="footer">
                            <!-- sign -->
                            <table id="custom_footer" style="width: 100%; font-size: 16px; margin-top: 5px; margin-bottom: 5px;">
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="reviser">
                                                <span>審核：</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="attention">
                                                <span>經辦：</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="accounter">
                                                <span>會計：</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="sales">
                                                <span>業務：</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="signture">
                                                <span>簽收：</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- page counter -->
                            <div class="page_counter" style="text-align: center; font-size:13px;">
                                <span>Page </span>
                                <span class="page"/>
of <span class="topage"/>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>

    </template>

</odoo>